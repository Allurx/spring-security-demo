<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zyc.security.mapper.UserMapper">

    <!--根据昵称查询用户-->
    <resultMap id="getUserByNickName" type="com.zyc.security.common.model.User">
        <id column="id" property="id"/>
        <collection property="roles" ofType="com.zyc.security.common.model.Role">
            <id column="roleId" property="id"/>
        </collection>
    </resultMap>
    <select id="getUserByNickName" resultMap="getUserByNickName">
        SELECT a.id,
               a.user_name userName,
               a.nick_name nickName,
               a.password,
               c.id roleId,
               c.name
        FROM user a
                 INNER JOIN user_role b ON a.id = b.user_id
                 INNER JOIN role c ON b.role_id = c.id
        WHERE nick_name = #{nickName}
          AND a.is_deleted = 0
    </select>
</mapper>